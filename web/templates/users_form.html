{{define "content"}}
{{$user := .Data.User}}
{{$suppliers := .Data.Suppliers}}
{{$isEdit := gt $user.ID 0}}
<form hx-post="{{if $isEdit}}/admin/users/{{$user.ID}}/edit{{else}}/admin/users{{end}}" hx-push-url="false">
    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
    <h1 style="display:none">{{.Title}}</h1>

    <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div class="form-group">
            <label for="uid">로그인 ID (UID)</label>
            <input type="text" id="uid" name="uid" value="{{$user.UID}}" required>
        </div>
        <div class="form-group">
            <label for="supplier_id">업체</label>
            <select id="supplier_id" name="supplier_id">
                <option value="">업체를 선택하세요</option>
                {{range $suppliers}}
                <option value="{{.ID}}" {{if int64PtrEq $user.SupplierID .ID}}selected{{end}}>{{.Name}}</option>
                {{end}}
            </select>
            <small style="color: var(--text-muted);">업체 사용자만 선택하세요.</small>
        </div>
    </div>

    <div class="form-group">
        <label for="password">비밀번호</label>
        <input type="password" id="password" name="password" {{if $isEdit}}{{else}}required{{end}}>
        <small style="color: var(--text-muted);">{{if $isEdit}}비워두면 기존 비밀번호를 유지합니다.{{else}}신규 등록 시 필수
            입력입니다.{{end}}</small>
    </div>

    <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div class="form-group">
            <label for="name">이름</label>
            <input type="text" id="name" name="name" value="{{$user.Name}}" required>
        </div>
        <div class="form-group">
            <label for="phone">연락처</label>
            <input type="text" id="phone" name="phone" value="{{$user.Phone}}" required>
        </div>
    </div>

    <div class="form-group">
        <label for="email">이메일</label>
        <input type="email" id="email" name="email" value="{{$user.Email}}" required>
    </div>

    <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div class="form-group">
            <label for="duty">직책</label>
            <select id="duty" name="duty">
                <option value="Senior" {{if eq $user.Duty "Senior" }}selected{{end}}>시니어</option>
                <option value="Assistant" {{if eq $user.Duty "Assistant" }}selected{{end}}>어시스턴트
                </option>
                <option value="Manager" {{if eq $user.Duty "Manager" }}selected{{end}}>매니저
                </option>
                <option value="Senior Manager" {{if eq $user.Duty "Senior Manager" }}selected{{end}}>
                    시니어 매니저</option>
                <option value="director" {{if eq $user.Duty "director" }}selected{{end}}>디렉터
                </option>
                <option value="other" {{if eq $user.Duty "other" }}selected{{end}}>기타</option>
            </select>
        </div>
        <div class="form-group">
            <label for="status">상태</label>
            <select id="status" name="status">
                <option value="active" {{if eq $user.Status "active" }}selected{{end}}>활성
                </option>
                <option value="suspened" {{if eq $user.Status "suspened" }}selected{{end}}>비활성
                </option>
                <option value="deleted" {{if eq $user.Status "deleted" }}selected{{end}}>삭제
                </option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label>권한</label>
        <div class="radio-group" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));">
            <label class="radio-card">
                <input class="radio-input" type="radio" name="role" value="internal_super_admin"
                    {{if or (eq $user.Role "INTERNAL_SUPER_ADMIN") (eq $user.Role "internal_super_admin")}}checked{{end}} required>
                <span class="radio-content">
                    <strong>총관리자</strong>
                </span>
            </label>
            <label class="radio-card">
                <input class="radio-input" type="radio" name="role" value="admin"
                    {{if eq $user.Role "admin"}}checked{{end}} required>
                <span class="radio-content">
                    <strong>관리자</strong>
                </span>
            </label>
            <label class="radio-card">
                <input class="radio-input" type="radio" name="role" value="staff"
                    {{if eq $user.Role "staff"}}checked{{end}} required>
                <span class="radio-content">
                    <strong>사원</strong>
                </span>
            </label>
            <label class="radio-card">
                <input class="radio-input" type="radio" name="role" value="supplier"
                    {{if eq $user.Role "supplier"}}checked{{end}} required>
                <span class="radio-content">
                    <strong>업체사용자</strong>
                </span>
            </label>
        </div>
        <small style="color: var(--text-muted); display: block; margin-top: 0.35rem;">
            총관리자: 전체 관리 · 관리자: 설정(규격/업체/BL포지션/차량번호) CRUD + 사용자 조회 · 사원: 입출고/BL마킹/휴가신청서 등록 및 본인만 수정/삭제 · 업체사용자: 전용 조회
        </small>
    </div>

    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
        <button type="submit" class="btn btn-primary" style="flex: 1; justify-content: center; padding: 1rem;">
            <svg viewBox="0 0 24 24" aria-hidden="true" width="18" height="18" fill="none" stroke="currentColor"
                stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            {{if $isEdit}}정보 수정{{else}}신규 등록{{end}}
        </button>
    </div>
</form>
{{end}}
